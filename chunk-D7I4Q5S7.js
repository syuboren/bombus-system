import{a as J}from"./chunk-WT4OEVCU.js";import{a as G}from"./chunk-PZOMZZZC.js";import{b as V,e as B,h as K,i as L,j as H,l as Q}from"./chunk-6NWKX4EL.js";import{a as q}from"./chunk-FPXKS7YP.js";import"./chunk-TKFFVAKG.js";import{$ as m,G as o,Ga as T,L as p,La as $,P as C,Q as S,R as b,Ta as N,X as g,Y as u,Z as n,_ as i,aa as y,ba as M,ca as O,fa as E,ga as A,ha as I,ia as r,ja as d,ka as j,la as D,n as x,o as w,sa as R,t as v,ta as F,u as _,za as z}from"./chunk-Y7UTIMVI.js";import"./chunk-GAL4ENT6.js";var W=["mainPredictionChart"],X=(a,e)=>e.rank,Y=(a,e)=>e.id,Z=(a,e)=>e.objective,ee=(a,e)=>e.projectName,te=()=>["\u5C08\u6848\u7BA1\u7406","AI \u640D\u76CA\u9810\u6E2C"];function ne(a,e){if(a&1){let t=y();n(0,"tr",22),M("click",function(){let s=v(t).$implicit,f=O();return _(f.navigateToProject(s.projectId))}),n(1,"td")(2,"div",23),r(3),i()(),n(4,"td"),r(5),i(),n(6,"td"),r(7),i(),n(8,"td"),r(9),i(),n(10,"td"),r(11),i()()}if(a&2){let t=e.$implicit,l=O();o(2),C("ngClass",l.getRankClass(t.rank)),o(),d(t.rank),o(2),d(t.projectName),o(2),d(t.pm),o(2),d(l.formatCurrency(t.revenue)),o(),b("profit-positive",t.profitRate>0)("profit-negative",t.profitRate<0),o(),D(" ",t.profitRate>0?"+":"","",t.profitRate,"% ")}}function ie(a,e){if(a&1&&(n(0,"div",24)(1,"div",25)(2,"span",26),r(3),i(),n(4,"span",27),r(5),i()(),n(6,"div",28),r(7),i(),n(8,"button",29),r(9,"\u67E5\u770B\u8A73\u60C5"),i()()),a&2){let t=e.$implicit;b("alert-card--warning",t.severity==="medium"),o(3),d(t.projectName),o(),b("alert-val--warning",t.severity==="medium"),o(),d(t.variance),o(2),d(t.description)}}function re(a,e){if(a&1&&(n(0,"div",31)(1,"div",32)(2,"span"),r(3),i(),n(4,"span"),r(5),i()(),n(6,"div",33),m(7,"div",34),i()()),a&2){let t=e.$implicit;o(3),d(t.projectName),o(2),j("",t.percentage,"%"),o(2),S("width",t.percentage,"%")}}function oe(a,e){if(a&1&&(n(0,"div",21)(1,"div",30),r(2),i(),g(3,re,8,4,"div",31,ee),i()),a&2){let t=e.$implicit;o(2),d(t.objective),o(),u(t.contributions)}}var U=class a{mainPredictionChartRef;projectService=x(J);router=x(N);cdr=x(z);mainPredictionChart=null;resizeHandler=()=>this.resizeCharts();loading=p(!1);rankings=p([]);alerts=p([]);okrAnalysis=p([]);predictions=p([]);selectedPeriod=p("quarter");ngOnInit(){this.loadData()}ngAfterViewInit(){window.addEventListener("resize",this.resizeHandler),setTimeout(()=>this.initChart(),100)}ngOnDestroy(){window.removeEventListener("resize",this.resizeHandler),this.mainPredictionChart?.dispose()}loadData(){this.loading.set(!0),this.projectService.getProjectRankings().subscribe({next:e=>this.rankings.set(e)}),this.projectService.getPerformanceAlerts().subscribe({next:e=>this.alerts.set(e)}),this.projectService.getOKRAnalysis().subscribe({next:e=>this.okrAnalysis.set(e)}),this.projectService.getProfitPredictions().subscribe({next:e=>{this.predictions.set(e),this.loading.set(!1),this.cdr.detectChanges(),setTimeout(()=>this.updateChart(),100)}})}initChart(){this.mainPredictionChartRef?.nativeElement&&(this.mainPredictionChart=G(this.mainPredictionChartRef.nativeElement),this.updateChart())}updateChart(){if(!this.mainPredictionChart)return;let e=this.predictions(),t=e.map(c=>c.month),l=e.map(c=>c.actual),s=e.map(c=>c.predicted),f=e.map(c=>c.optimistic),h=e.map(c=>c.pessimistic);this.mainPredictionChart.setOption({tooltip:{trigger:"axis",formatter:c=>{let k=c[0].name+"<br/>";return c.forEach(P=>{P.value!==null&&(k+=P.seriesName+": $"+P.value+"M<br/>")}),k}},legend:{data:["\u6B77\u53F2\u640D\u76CA","AI \u9810\u6E2C (\u60B2\u89C0)","AI \u9810\u6E2C (\u57FA\u6E96)","AI \u9810\u6E2C (\u6A02\u89C0)"],bottom:0},grid:{left:"3%",right:"4%",bottom:"15%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:t},yAxis:{type:"value",name:"\u6DE8\u5229 (Million)",axisLabel:{formatter:"${value}M"}},series:[{name:"\u6B77\u53F2\u640D\u76CA",type:"line",data:l,itemStyle:{color:"#64748B"},lineStyle:{width:3},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(100, 116, 139, 0.3)"},{offset:1,color:"rgba(100, 116, 139, 0)"}]}}},{name:"AI \u9810\u6E2C (\u57FA\u6E96)",type:"line",smooth:!0,lineStyle:{type:"dashed",width:3},data:s,itemStyle:{color:"#9A8C98"}},{name:"AI \u9810\u6E2C (\u6A02\u89C0)",type:"line",smooth:!0,lineStyle:{type:"dotted",opacity:.5},data:f,itemStyle:{color:"#7FB095"},symbol:"none"},{name:"AI \u9810\u6E2C (\u60B2\u89C0)",type:"line",smooth:!0,lineStyle:{type:"dotted",opacity:.5},data:h,itemStyle:{color:"#C77F7F"},symbol:"none"}]})}resizeCharts(){this.mainPredictionChart?.resize()}onPeriodChange(e){this.selectedPeriod.set(e)}navigateToProject(e){this.router.navigate(["/project/detail",e])}getRankClass(e){switch(e){case 1:return"rank-1";case 2:return"rank-2";case 3:return"rank-3";default:return""}}formatCurrency(e){return e>=1e6?`$${(e/1e6).toFixed(1)}M`:`$${(e/1e3).toFixed(0)}K`}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=w({type:a,selectors:[["app-profit-prediction-page"]],viewQuery:function(t,l){if(t&1&&E(W,5),t&2){let s;A(s=I())&&(l.mainPredictionChartRef=s.first)}},standalone:!0,features:[R],decls:53,vars:3,consts:[["mainPredictionChart",""],["pageTitle","AI \u640D\u76CA\u9810\u6E2C\u8207\u7E3E\u6548\u5206\u6790",3,"breadcrumbs"],[1,"profit-prediction-page"],[1,"chart-panel"],[1,"panel-header"],[1,"panel-title"],[1,"ri-line-chart-line"],[1,"prediction-badge"],[1,"ri-magic-line"],[1,"main-chart"],[1,"page-grid"],[1,"form-select","form-select--small",3,"ngModelChange","ngModel"],["value","quarter"],["value","year"],[1,"leaderboard-table"],["width","50"],[1,"panel-title","panel-title--danger"],[1,"ri-alarm-warning-line"],[1,"alert-list"],[1,"alert-card",3,"alert-card--warning"],[1,"okr-matrix"],[1,"okr-card"],[3,"click"],[1,"rank-num",3,"ngClass"],[1,"alert-card"],[1,"alert-header"],[1,"alert-project"],[1,"alert-val"],[1,"alert-desc"],[1,"btn-secondary","btn-secondary--sm"],[1,"okr-title"],[1,"contribution-item"],[1,"contribution-label"],[1,"contribution-bar"],[1,"contribution-fill"]],template:function(t,l){if(t&1){let s=y();m(0,"app-header",1),n(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5),m(5,"i",6),r(6," \u516C\u53F8\u6574\u9AD4\u5C08\u6848\u640D\u76CA\u8DA8\u52E2 (AI \u9810\u6E2C) "),i(),n(7,"div",7),m(8,"i",8),r(9," AI Confidence: 92% "),i()(),m(10,"div",9,0),i(),n(12,"div",10)(13,"div",3)(14,"div",4)(15,"div",5),r(16,"\u5C08\u6848\u7372\u5229\u6392\u884C\u699C (Profit Leaderboard)"),i(),n(17,"select",11),M("ngModelChange",function(h){return v(s),_(l.onPeriodChange(h))}),n(18,"option",12),r(19,"\u672C\u5B63"),i(),n(20,"option",13),r(21,"\u672C\u5E74\u5EA6"),i()()(),n(22,"table",14)(23,"thead")(24,"tr")(25,"th",15),r(26,"\u6392\u540D"),i(),n(27,"th"),r(28,"\u5C08\u6848\u540D\u7A31"),i(),n(29,"th"),r(30,"\u8CA0\u8CAC\u4EBA"),i(),n(31,"th"),r(32,"\u71DF\u6536"),i(),n(33,"th"),r(34,"\u6BDB\u5229\u7387"),i()()(),n(35,"tbody"),g(36,ne,12,11,"tr",null,X),i()()(),n(38,"div",3)(39,"div",4)(40,"div",16),m(41,"i",17),r(42," \u6548\u80FD\u504F\u5DEE\u8B66\u793A "),i()(),n(43,"div",18),g(44,ie,10,7,"div",19,Y),i()()(),n(46,"div",3)(47,"div",4)(48,"div",5),r(49,"\u5C08\u6848 OKR \u8CA2\u737B\u5EA6\u5206\u6790"),i()(),n(50,"div",20),g(51,oe,5,1,"div",21,Z),i()()()}t&2&&(C("breadcrumbs",F(2,te)),o(17),C("ngModel",l.selectedPeriod()),o(19),u(l.rankings()),o(8),u(l.alerts()),o(7),u(l.okrAnalysis()))},dependencies:[$,T,Q,L,H,K,V,B,q],styles:['.profit-prediction-page[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px;padding:20px;padding-top:calc(var(--header-height, 70px) + 20px)}.chart-panel[_ngcontent-%COMP%]{background:#fff;border-radius:12px;border:1px solid #e2e8f0;padding:25px}.panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.panel-title[_ngcontent-%COMP%]{font-size:18px;font-weight:700;color:#1e293b;display:flex;align-items:center;gap:10px}.panel-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#9a8c98}.panel-title--danger[_ngcontent-%COMP%], .panel-title--danger[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#c77f7f}.prediction-badge[_ngcontent-%COMP%]{background:linear-gradient(135deg,#9a8c98,#64748b);color:#fff;padding:4px 12px;border-radius:20px;font-size:12px;font-weight:600;display:flex;align-items:center;gap:5px}.main-chart[_ngcontent-%COMP%]{width:100%;height:350px}.page-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr;gap:20px}@media (max-width: 1200px){.page-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.form-select[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid #e2e8f0;border-radius:8px;background:#fff;font-size:14px;color:#1e293b;cursor:pointer}.form-select[_ngcontent-%COMP%]:focus{outline:none;border-color:#9a8c98}.form-select--small[_ngcontent-%COMP%]{width:120px}.leaderboard-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.leaderboard-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;padding:12px;color:#64748b;font-size:13px;border-bottom:1px solid #e2e8f0}.leaderboard-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:15px 12px;border-bottom:1px solid #e2e8f0;font-size:14px;color:#1e293b}.leaderboard-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{cursor:pointer;transition:background .2s}.leaderboard-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#f8fafc}.rank-num[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;background:#eee;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:#666}.rank-num.rank-1[_ngcontent-%COMP%]{background:gold;color:#b45f06}.rank-num.rank-2[_ngcontent-%COMP%]{background:silver;color:#444}.rank-num.rank-3[_ngcontent-%COMP%]{background:#cd7f32;color:#5b3a29}.profit-positive[_ngcontent-%COMP%]{color:#7fb095;font-weight:600}.profit-negative[_ngcontent-%COMP%]{color:#c77f7f;font-weight:600}.alert-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:15px}.alert-card[_ngcontent-%COMP%]{background:#fff;border:1px solid rgba(199,127,127,.3);border-left:4px solid #C77F7F;border-radius:8px;padding:15px;position:relative;overflow:hidden;transition:transform .2s}.alert-card[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(90deg,#c77f7f0d,#fff0);pointer-events:none}.alert-card[_ngcontent-%COMP%]:hover{transform:translate(5px);box-shadow:0 5px 15px #c77f7f1a}.alert-card--warning[_ngcontent-%COMP%]{border-color:#e3c0884d;border-left-color:#e3c088}.alert-card--warning[_ngcontent-%COMP%]:before{background:linear-gradient(90deg,#e3c0880d,#fff0)}.alert-card--warning[_ngcontent-%COMP%]:hover{box-shadow:0 5px 15px #e3c0881a}.alert-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:8px}.alert-project[_ngcontent-%COMP%]{font-weight:700;color:#1e293b}.alert-val[_ngcontent-%COMP%]{color:#c77f7f;font-weight:700}.alert-val--warning[_ngcontent-%COMP%]{color:#e3c088}.alert-desc[_ngcontent-%COMP%]{font-size:13px;color:#64748b;line-height:1.5;margin-bottom:10px}.btn-secondary[_ngcontent-%COMP%]{padding:8px 16px;background:#fff;color:#1e293b;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;justify-content:center;gap:5px}.btn-secondary[_ngcontent-%COMP%]:hover{border-color:#9a8c98;color:#9a8c98}.btn-secondary--sm[_ngcontent-%COMP%]{width:100%;padding:6px;font-size:12px}.okr-matrix[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:15px}@media (max-width: 1000px){.okr-matrix[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (max-width: 600px){.okr-matrix[_ngcontent-%COMP%]{grid-template-columns:1fr}}.okr-card[_ngcontent-%COMP%]{background:#f8fafc;border-radius:8px;padding:15px;border:1px solid #e2e8f0}.okr-title[_ngcontent-%COMP%]{font-size:13px;font-weight:600;color:#64748b;margin-bottom:15px}.contribution-item[_ngcontent-%COMP%]{margin-bottom:10px}.contribution-item[_ngcontent-%COMP%]:last-child{margin-bottom:0}.contribution-label[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:12px;margin-bottom:4px;color:#1e293b}.contribution-bar[_ngcontent-%COMP%]{height:8px;background:#eee;border-radius:4px;overflow:hidden}.contribution-fill[_ngcontent-%COMP%]{height:100%;background:#9a8c98;border-radius:4px;transition:width .3s ease}'],changeDetection:0})};export{U as ProfitPredictionPageComponent};
