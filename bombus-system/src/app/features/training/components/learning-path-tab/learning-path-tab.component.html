<div class="map-card">
  <header class="map-card__header">
    <h2 class="map-card__title">
      <i class="ri-route-fill"></i>
      å­¸ç¿’ç™¼å±•è·¯å¾‘åœ– (Learning Journey Map)
    </h2>
    <p class="map-card__desc">
      ç‚ºå“¡å·¥æä¾›æ¸…æ™°çš„è·æ¶¯ç™¼å±•è·¯å¾‘èˆ‡å€‹äººåŒ–å­¸ç¿’åœ°åœ–ã€‚AIæ™ºèƒ½æ¨è–¦å­¸ç¿’é †åºèˆ‡æ™‚é–“ã€‚
    </p>
  </header>

  <!-- View Level Filter -->
  <div class="filters">
    <div class="filter-group">
      <label for="learningPathLevel">è¦–åœ–å±¤ç´š:</label>
      <select
        id="learningPathLevel"
        [value]="viewLevel()"
        (change)="switchViewLevel($any($event.target).value)">
        @for (opt of viewLevelOptions; track opt.value) {
          <option [value]="opt.value">{{ opt.label }}</option>
        }
      </select>
    </div>
  </div>

  <!-- Progress Overview -->
  <div class="progress-overview">
    @for (item of progressData(); track item.title) {
      <div class="progress-card" [style.border-top-color]="item.color">
        <span class="progress-card__label">{{ item.title }}</span>
        <span class="progress-card__value">{{ item.value }}%</span>
        <div class="progress-card__bar">
          <div
            class="progress-card__fill"
            [style.width.%]="item.value"
            [style.background]="item.color">
          </div>
        </div>
      </div>
    }
  </div>

  <!-- Employee Selector (Individual Level) -->
  @if (viewLevel() === 'individual') {
    <div class="employee-selector">
      <div class="filter-group">
        <label for="employeeSelect">é¸æ“‡å“¡å·¥:</label>
        <select
          id="employeeSelect"
          [value]="selectedEmployee()"
          (change)="selectEmployee($any($event.target).value)">
          @for (opt of employeeOptions; track opt.value) {
            <option [value]="opt.value">{{ opt.label }}</option>
          }
        </select>
      </div>
    </div>

    <!-- Path Summary -->
    @if (selectedEmployee() && pathSteps().length > 0) {
      <div class="path-summary">
        <h3 class="path-summary__title">ğŸ¯ å€‹äººå­¸ç¿’è·¯å¾‘</h3>
        <p class="path-summary__desc">æ ¹æ“šè·èƒ½è©•ä¼°çµæœï¼ŒAI æ¨è–¦ä»¥ä¸‹å­¸ç¿’è·¯å¾‘</p>
        <div class="path-steps">
          @for (step of pathSteps(); track step.name; let i = $index) {
            @if (i > 0) {
              <i class="ri-arrow-right-line path-arrow"></i>
            }
            <span class="path-step path-step--{{ step.status }}">
              {{ step.name }}
            </span>
          }
        </div>
      </div>
    }
  }

  <!-- Timeline Chart -->
  <section class="chart-section">
    <div class="chart-card">
      <div #timelineChart class="chart-container"></div>
      <button class="export-btn" (click)="exportChart('timeline')" type="button">
        <i class="ri-download-2-line"></i>
        åŒ¯å‡ºæ™‚é–“è»¸ PNG
      </button>
    </div>
  </section>

  <!-- Skill Tree Chart -->
  <section class="chart-section">
    <div class="chart-card">
      <div #skillTreeChart class="chart-container"></div>
      <button class="export-btn" (click)="exportChart('skillTree')" type="button">
        <i class="ri-download-2-line"></i>
        åŒ¯å‡ºæŠ€èƒ½æ¨¹ PNG
      </button>
    </div>
  </section>

  <!-- Course Recommendations -->
  <section class="courses-section">
    <h3 class="section-title">ğŸ’¡ AI æ¨è–¦èª²ç¨‹</h3>
    <div class="course-grid">
      @for (course of courses(); track course.id) {
        <article class="course-card">
          <header class="course-card__header">
            <span class="course-badge" [class]="getCourseLevelClass(course.level)">
              @switch (course.level) {
                @case ('basic') { åŸºç¤ }
                @case ('advanced') { é€²éš }
                @case ('expert') { å°ˆå®¶ }
              }
            </span>
          </header>
          <h4 class="course-card__title">{{ course.title }}</h4>
          <div class="course-card__meta">
            <span><i class="ri-time-line"></i> {{ course.duration }}</span>
            <span><i class="ri-user-line"></i> {{ course.participants }} äºº</span>
          </div>
          <p class="course-card__desc">{{ course.description }}</p>
          <footer class="course-card__footer">
            <div class="course-progress">
              <div class="mini-progress-bar">
                <div class="mini-progress-fill" [style.width.%]="course.progress"></div>
              </div>
              <span>{{ course.progress }}%</span>
            </div>
          </footer>
        </article>
      }
    </div>
  </section>
</div>
