<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 損益預測 - Bombus V6.0</title>
    <!-- Remix Icon -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <!-- System CSS -->
    <link rel="stylesheet" href="../assets/css/system.css">
    <style>
        :root {
            --color-brand-main: var(--color-l4-mauve);
        }

        .page-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-panel {
            background: var(--color-bg-card);
            border-radius: 12px;
            border: 1px solid var(--color-border);
            padding: 25px;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .panel-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--color-text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .prediction-badge {
            background: linear-gradient(135deg, #9A8C98 0%, #64748B 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Variance Alert List */
        .alert-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .alert-card {
            background: white;
            border: 1px solid rgba(199, 127, 127, 0.3);
            border-left: 4px solid var(--color-danger);
            border-radius: 8px;
            padding: 15px;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s;
        }

        .alert-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(199, 127, 127, 0.1);
        }

        .alert-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, rgba(199,127,127,0.05) 0%, rgba(255,255,255,0) 100%);
            pointer-events: none;
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .alert-project {
            font-weight: 700;
            color: var(--color-text-primary);
        }

        .alert-val {
            color: var(--color-danger);
            font-weight: 700;
        }

        .alert-desc {
            font-size: 13px;
            color: var(--color-text-secondary);
            line-height: 1.5;
        }

        /* Leaderboard Table */
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
        }

        .leaderboard-table th {
            text-align: left;
            padding: 12px;
            color: var(--color-text-secondary);
            font-size: 13px;
            border-bottom: 1px solid var(--color-border);
        }

        .leaderboard-table td {
            padding: 15px 12px;
            border-bottom: 1px solid var(--color-border);
            font-size: 14px;
            color: var(--color-text-primary);
        }

        .rank-num {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            color: #666;
        }

        .rank-1 { background: #FFD700; color: #B45F06; }
        .rank-2 { background: #C0C0C0; color: #444; }
        .rank-3 { background: #CD7F32; color: #5B3A29; }

        .profit-positive { color: var(--color-success); font-weight: 600; }
        .profit-negative { color: var(--color-danger); font-weight: 600; }

        /* OKR Contribution Matrix */
        .okr-matrix {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .okr-card {
            background: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--color-border);
        }

        .okr-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--color-text-secondary);
            margin-bottom: 10px;
        }

        .contribution-bar {
            height: 8px;
            background: #eee;
            border-radius: 4px;
            margin-bottom: 5px;
            overflow: hidden;
        }

        .contribution-fill {
            height: 100%;
            background: var(--color-l4-mauve);
        }
    </style>
</head>
<body>
    <div class="system-wrapper">
        <!-- Sidebar -->
        <aside class="system-aside" id="kt_aside">
            <div class="aside-brand">
                <div class="brand-logo">
                    <img src="../assets/images/logo-bombus.svg" alt="Bombus Logo" class="logo">
                    <span class="brand-text">Bombus</span>
                </div>
                <button class="aside-toggle-btn" id="aside_toggle"><i class="ri-arrow-left-s-line"></i></button>
            </div>
            <nav class="aside-menu">
                <div class="menu-wrapper">
                    <div class="menu-item"><a href="../index.html" class="menu-link"><span class="menu-icon"><i class="ri-dashboard-line"></i></span><span class="menu-text">企業管理儀表板</span><span class="menu-badge">L0.0</span></a></div>
                    
                    <!-- L4 Project Management (Active) -->
                    <div class="menu-item menu-accordion show">
                        <div class="menu-link" data-toggle="collapse">
                            <span class="menu-icon module-l4"><i class="ri-folder-chart-line"></i></span>
                            <span class="menu-text">專案管理</span>
                            <span class="menu-arrow"><i class="ri-arrow-down-s-line"></i></span>
                        </div>
                        <div class="menu-sub">
                            <div class="menu-item"><a href="./list.html" class="menu-link"><span class="menu-bullet"></span><span class="menu-text">專案列表</span></a></div>
                            <div class="menu-item"><a href="./profit-prediction.html" class="menu-link active"><span class="menu-bullet"></span><span class="menu-text">AI損益預測</span></a></div>
                        </div>
                    </div>
                </div>
            </nav>
        </aside>

        <div class="page-wrapper">
            <header class="system-header">
                <div class="header-container">
                    <button class="mobile-toggle" id="mobile_toggle"><i class="ri-menu-line"></i></button>
                    <div class="page-title">
                        <h1 class="title-text">AI 損益預測與績效分析</h1>
                        <div class="breadcrumb">
                            <span class="breadcrumb-item">專案管理</span>
                            <i class="ri-arrow-right-s-line"></i>
                            <span class="breadcrumb-item active">AI 損益預測</span>
                        </div>
                    </div>
                    <div class="header-actions">
                        <button class="action-btn"><i class="ri-search-line"></i></button>
                        <button class="action-btn"><i class="ri-notification-3-line"></i></button>
                        <button class="action-btn user-menu-btn"><img src="../assets/images/avatar.jpg" class="user-avatar-small"></button>
                    </div>
                </div>
            </header>

            <main class="main-content">
                <div class="content-container">
                    
                    <!-- Top: AI Prediction Chart -->
                    <div class="chart-panel" style="margin-bottom: 20px;">
                        <div class="panel-header">
                            <div class="panel-title">
                                <i class="ri-line-chart-line" style="color: var(--color-l4-mauve);"></i>
                                公司整體專案損益趨勢 (AI 預測)
                            </div>
                            <div class="prediction-badge">
                                <i class="ri-magic-line"></i> AI Confidence: 92%
                            </div>
                        </div>
                        <div id="mainPredictionChart" style="width: 100%; height: 350px;"></div>
                    </div>

                    <div class="page-grid">
                        <!-- Left: Leaderboard -->
                        <div class="chart-panel">
                            <div class="panel-header">
                                <div class="panel-title">專案獲利排行榜 (Profit Leaderboard)</div>
                                <select class="form-select" style="width: 120px;">
                                    <option>本季</option>
                                    <option>本年度</option>
                                </select>
                            </div>
                            <table class="leaderboard-table">
                                <thead>
                                    <tr>
                                        <th width="50">排名</th>
                                        <th>專案名稱</th>
                                        <th>負責人</th>
                                        <th>營收</th>
                                        <th>毛利率</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><div class="rank-num rank-1">1</div></td>
                                        <td>金融區塊鏈交易模組</td>
                                        <td>David Wu</td>
                                        <td>$3.5M</td>
                                        <td class="profit-positive">45.2%</td>
                                    </tr>
                                    <tr>
                                        <td><div class="rank-num rank-2">2</div></td>
                                        <td>企業級 CRM 系統重構</td>
                                        <td>Alex Chen</td>
                                        <td>$4.0M</td>
                                        <td class="profit-positive">32.5%</td>
                                    </tr>
                                    <tr>
                                        <td><div class="rank-num rank-3">3</div></td>
                                        <td>雲端資料倉儲遷移</td>
                                        <td>Jessica Lin</td>
                                        <td>$2.8M</td>
                                        <td class="profit-positive">28.1%</td>
                                    </tr>
                                    <tr>
                                        <td><div class="rank-num">4</div></td>
                                        <td>AI 客服機器人開發</td>
                                        <td>Mike Wang</td>
                                        <td>$1.5M</td>
                                        <td class="profit-positive">12.4%</td>
                                    </tr>
                                    <tr>
                                        <td><div class="rank-num">5</div></td>
                                        <td>Q4 行銷自動化平台</td>
                                        <td>Sarah Lin</td>
                                        <td>$2.0M</td>
                                        <td class="profit-negative">-5.2%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Right: Variance Alerts -->
                        <div class="chart-panel">
                            <div class="panel-header">
                                <div class="panel-title" style="color: var(--color-danger);">
                                    <i class="ri-alarm-warning-line"></i> 效能偏差警示
                                </div>
                            </div>
                            <div class="alert-list">
                                <div class="alert-card">
                                    <div class="alert-header">
                                        <span class="alert-project">Q4 行銷自動化平台</span>
                                        <span class="alert-val">-15% 偏差</span>
                                    </div>
                                    <div class="alert-desc">
                                        進度嚴重落後。關鍵路徑任務 "API 整合" 延遲 2 週，預計導致成本超支 $200k。
                                    </div>
                                    <button class="btn-secondary" style="margin-top: 10px; width: 100%; justify-content: center; padding: 6px; font-size: 12px;">查看詳情</button>
                                </div>

                                <div class="alert-card" style="border-left-color: var(--color-warning); border-color: rgba(227, 192, 136, 0.3);">
                                    <div class="alert-header">
                                        <span class="alert-project">AI 客服機器人</span>
                                        <span class="alert-val" style="color: var(--color-warning);">成本偏高</span>
                                    </div>
                                    <div class="alert-desc">
                                        GPU 算力成本超出預算 8%。建議優化模型推論效率。
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bottom: OKR Contribution -->
                    <div class="chart-panel">
                        <div class="panel-header">
                            <div class="panel-title">專案 OKR 貢獻度分析</div>
                        </div>
                        <div class="okr-matrix">
                            <div class="okr-card">
                                <div class="okr-title">O1: 提升年度營收達 20%</div>
                                <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 2px;">
                                    <span>金融區塊鏈</span>
                                    <span>40%</span>
                                </div>
                                <div class="contribution-bar"><div class="contribution-fill" style="width: 40%;"></div></div>
                                
                                <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 2px;">
                                    <span>CRM 重構</span>
                                    <span>25%</span>
                                </div>
                                <div class="contribution-bar"><div class="contribution-fill" style="width: 25%; opacity: 0.6;"></div></div>
                            </div>

                            <div class="okr-card">
                                <div class="okr-title">O2: 優化客戶滿意度 (NPS > 50)</div>
                                <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 2px;">
                                    <span>AI 客服機器人</span>
                                    <span>60%</span>
                                </div>
                                <div class="contribution-bar"><div class="contribution-fill" style="width: 60%;"></div></div>
                                
                                <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 2px;">
                                    <span>行銷自動化</span>
                                    <span>15%</span>
                                </div>
                                <div class="contribution-bar"><div class="contribution-fill" style="width: 15%; opacity: 0.6;"></div></div>
                            </div>

                            <div class="okr-card">
                                <div class="okr-title">O3: 技術基礎建設現代化</div>
                                <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 2px;">
                                    <span>雲端遷移</span>
                                    <span>80%</span>
                                </div>
                                <div class="contribution-bar"><div class="contribution-fill" style="width: 80%;"></div></div>
                            </div>
                        </div>
                    </div>

                </div>
            </main>
        </div>
    </div>

    <script src="../assets/js/system.js"></script>
    <script>
        // AI Prediction Chart
        const chart = echarts.init(document.getElementById('mainPredictionChart'));
        
        const option = {
            tooltip: {
                trigger: 'axis',
                formatter: function (params) {
                    let html = params[0].name + '<br/>';
                    params.forEach(param => {
                        html += param.seriesName + ': ' + param.value + 'M<br/>';
                    });
                    return html;
                }
            },
            legend: {
                data: ['歷史損益', 'AI 預測 (悲觀)', 'AI 預測 (基準)', 'AI 預測 (樂觀)'],
                bottom: 0
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '10%',
                containLabel: true
            },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                data: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
            },
            yAxis: {
                type: 'value',
                name: '淨利 (Million)',
                axisLabel: { formatter: '${value}M' }
            },
            series: [
                {
                    name: '歷史損益',
                    type: 'line',
                    data: [1.2, 1.5, 1.4, 1.8, 2.1, 2.3, null, null, null, null, null, null],
                    itemStyle: { color: '#64748B' },
                    lineStyle: { width: 3 },
                    areaStyle: { color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{offset: 0, color: 'rgba(100, 116, 139, 0.3)'}, {offset: 1, color: 'rgba(100, 116, 139, 0)'}]) }
                },
                {
                    name: 'AI 預測 (基準)',
                    type: 'line',
                    smooth: true,
                    lineStyle: { type: 'dashed', width: 3 },
                    data: [null, null, null, null, null, 2.3, 2.5, 2.8, 3.1, 3.4, 3.8, 4.2],
                    itemStyle: { color: '#9A8C98' }
                },
                {
                    name: 'AI 預測 (樂觀)',
                    type: 'line',
                    smooth: true,
                    lineStyle: { type: 'dotted', opacity: 0.5 },
                    data: [null, null, null, null, null, 2.3, 2.7, 3.2, 3.6, 4.1, 4.6, 5.2],
                    itemStyle: { color: '#7FB095' },
                    symbol: 'none'
                },
                {
                    name: 'AI 預測 (悲觀)',
                    type: 'line',
                    smooth: true,
                    lineStyle: { type: 'dotted', opacity: 0.5 },
                    data: [null, null, null, null, null, 2.3, 2.2, 2.0, 1.8, 1.5, 1.2, 1.0],
                    itemStyle: { color: '#C77F7F' },
                    symbol: 'none'
                }
            ]
        };

        chart.setOption(option);

        window.addEventListener('resize', function() {
            chart.resize();
        });
    </script>
</body>
</html>

