<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L3.2 多層次人才地圖生成引擎 - Bombus V6.0</title>
    <!-- Remix Icon -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- jQuery UI -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
    <!-- ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <!-- System CSS -->
    <link rel="stylesheet" href="../assets/css/system.css">
    <!-- Talent Map CSS -->
    <style>
        .talent-map-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: var(--color-bg-card);
            padding: 10px;
            border-radius: var(--border-radius);
            border: 1px solid var(--color-border);
        }

        .tab-btn {
            flex: 1;
            padding: 15px 20px;
            background: transparent;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tab-btn:hover {
            background: var(--color-bg-base);
            color: var(--color-brand-main);
        }

        .tab-btn.active {
            background: var(--color-l3-petrol);
            color: white;
            box-shadow: 0 4px 15px rgba(127, 156, 160, 0.3);
        }

        .tab-btn i {
            font-size: 20px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .map-card {
            background: var(--color-bg-card);
            border-radius: var(--border-radius);
            border: 1px solid var(--color-border);
            padding: 30px;
            margin-bottom: 20px;
        }

        .map-card-header {
            margin-bottom: 25px;
        }

        .map-card-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--color-text-primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .map-card-title i {
            color: var(--color-l3-petrol);
        }

        .map-card-desc {
            font-size: 14px;
            color: var(--color-text-secondary);
        }

        .filters {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 25px;
            padding: 20px;
            background: var(--color-bg-base);
            border-radius: 10px;
        }

        .filters label {
            font-size: 14px;
            font-weight: 600;
            color: var(--color-text-primary);
            white-space: nowrap;
        }

        .filters select {
            padding: 10px 15px;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            background: white;
            color: var(--color-text-primary);
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
            min-width: 150px;
        }

        .filters select:hover {
            border-color: var(--color-brand-main);
        }

        .filters select:focus {
            outline: none;
            border-color: var(--color-brand-main);
            box-shadow: 0 0 0 3px rgba(100, 116, 139, 0.1);
        }

        .chart-container {
            width: 100%;
            height: 500px;
            min-height: 500px;
            max-width: 100%;
        }

        .chart-combo {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        @media (min-width: 1400px) {
            .chart-combo {
                grid-template-columns: 1.3fr 0.9fr;
            }
        }


        .legend-info {
            display: flex;
            flex-direction: column;
            line-height: 1.2;
        }

        .legend-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--color-text-primary);
        }

        .legend-value {
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        .export-button {
            margin-top: 20px;
            padding: 12px 24px;
            background: var(--color-brand-main);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .export-button:hover {
            background: var(--color-brand-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(100, 116, 139, 0.3);
        }

        .export-button i {
            font-size: 16px;
        }

        /* Dashboard Grid for Key Talent */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: var(--color-bg-card);
            border-radius: var(--border-radius);
            border: 1px solid var(--color-border);
            padding: 25px;
            text-align: center;
            transition: var(--transition);
        }

        .metric-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--box-shadow);
        }

        .metric-card h3 {
            font-size: 16px;
            color: var(--color-text-primary);
            margin-bottom: 15px;
            font-weight: 600;
        }

        .metric-value {
            font-size: 36px;
            font-weight: 700;
            margin: 15px 0;
        }

        .metric-description {
            font-size: 13px;
            color: var(--color-text-secondary);
            margin-bottom: 15px;
        }

        .small-button {
            padding: 10px 20px;
            font-size: 13px;
            border-radius: 8px;
            background: var(--color-l1-sage);
            color: white;
            border: none;
            cursor: pointer;
            transition: var(--transition);
        }

        .small-button:hover {
            opacity: 0.85;
            transform: translateY(-2px);
        }

        /* Nine Box Employee Cards */
        .employee-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .employee-card {
            background: white;
            border-radius: 8px;
            padding: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: move;
            transition: var(--transition);
            border: 1px solid var(--color-border);
        }

        .employee-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .employee-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--color-brand-main);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            flex-shrink: 0;
        }

        .employee-info {
            flex: 1;
        }

        .employee-name {
            font-weight: 600;
            color: var(--color-text-primary);
            font-size: 13px;
        }

        .employee-dept {
            font-size: 11px;
            color: var(--color-text-secondary);
        }

        .employee-scores {
            display: flex;
            gap: 8px;
            font-size: 11px;
        }

        .score-badge {
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }

        .score-badge.performance {
            background: rgba(127, 156, 160, 0.2);
            color: #7F9CA0;
        }

        .score-badge.potential {
            background: rgba(141, 163, 153, 0.2);
            color: #8DA399;
        }

        /* Course Card Styling */
        .course-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--color-border);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .course-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
            border-color: var(--color-brand-main);
        }

        .course-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .course-badge {
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }

        .course-badge.basic {
            background: var(--color-l1-sage);
        }

        .course-badge.advanced {
            background: var(--color-l2-clay);
        }

        .course-badge.expert {
            background: var(--color-l4-mauve);
        }

        .course-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--color-text-primary);
            line-height: 1.4;
        }

        .course-meta {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        .course-description {
            font-size: 13px;
            color: var(--color-text-secondary);
            line-height: 1.6;
            flex: 1;
        }

        .course-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 12px;
            border-top: 1px solid var(--color-border);
        }

        .course-progress {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .mini-progress-bar {
            flex: 1;
            height: 6px;
            background: var(--color-bg-base);
            border-radius: 3px;
            overflow: hidden;
        }

        .mini-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-l3-petrol), var(--color-l1-sage));
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .course-progress span {
            font-size: 12px;
            font-weight: 600;
            color: var(--color-text-primary);
            min-width: 35px;
        }

        /* Path Step Styling */
        .path-step {
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap;
            border: 2px solid;
        }

        .path-step.completed {
            background: rgba(127, 176, 149, 0.15);
            border-color: #7FB095;
            color: #7FB095;
        }

        .path-step.current {
            background: rgba(127, 156, 160, 0.15);
            border-color: #7F9CA0;
            color: #7F9CA0;
        }

        .path-step.pending {
            background: rgba(133, 142, 150, 0.1);
            border-color: #E2E4E8;
            color: var(--color-text-secondary);
        }

        /* Level Tab Active State */
        .level-tab.active {
            background: linear-gradient(135deg, rgba(127, 156, 160, 0.15) 0%, rgba(127, 156, 160, 0.25) 100%);
            border: 2px solid var(--color-l3-petrol) !important;
            color: var(--color-text-primary);
        }

        /* Key Talent Alert Item */
        .alert-item {
            background: white;
            border-radius: 10px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-left: 4px solid;
            border: 1px solid var(--color-border);
            border-left-width: 4px;
        }
        .alert-item.high { border-left-color: #C77F7F; }
        .alert-item.medium { border-left-color: #E3C088; }
        
        .alert-item .avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--color-brand-main);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            flex-shrink: 0;
        }
        
        .alert-item .info { flex: 1; }
        .alert-item .name { font-weight: 700; color: var(--color-text-primary); }
        .alert-item .detail { font-size: 13px; color: var(--color-text-secondary); }
        
        .alert-item .risk-score {
            font-size: 24px;
            font-weight: 700;
            text-align: center;
            min-width: 60px;
            flex-shrink: 0;
        }
        .alert-item.high .risk-score { color: #C77F7F; }
        .alert-item.medium .risk-score { color: #E3C088; }
        
        .alert-item .action-btn {
            width: auto;
            height: auto;
            padding: 8px 16px;
            background: var(--color-brand-main);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
            flex-shrink: 0;
        }
        .alert-item .action-btn:hover { background: var(--color-brand-dark); }

        /* Succession Card */
        .succession-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--color-border);
            transition: var(--transition);
        }
        .succession-card:hover { box-shadow: var(--box-shadow); }
        
        .succession-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--color-border);
        }
        
        .position-title { font-weight: 700; color: var(--color-text-primary); }
        
        .coverage-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
        }
        .coverage-badge.high { background: rgba(127, 176, 149, 0.15); color: var(--color-success); }
        .coverage-badge.medium { background: rgba(227, 192, 136, 0.15); color: #a88643; }
        .coverage-badge.low { background: rgba(199, 127, 127, 0.15); color: var(--color-danger); }
        
        .succession-list { display: flex; flex-direction: column; gap: 10px; }
        
        .successor-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--color-bg-base);
            border-radius: 8px;
        }
        
        .successor-rank {
            width: 24px;
            height: 24px;
            background: var(--color-brand-main);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
            flex-shrink: 0;
        }
        
        .successor-name { flex: 1; font-size: 13px; font-weight: 600; color: var(--color-text-primary); }
        
        .readiness-bar {
            width: 60px;
            height: 6px;
            background: #E2E4E8;
            border-radius: 3px;
            overflow: hidden;
        }
        
        .readiness-fill { height: 100%; background: var(--color-success); border-radius: 3px; }
        .readiness-score { font-size: 12px; font-weight: 700; color: var(--color-text-secondary); }
    </style>
</head>
<body>
    <div class="system-wrapper">
        <!-- Begin: Sidebar -->
        <aside class="system-aside" id="kt_aside">
            <!-- Brand -->
            <div class="aside-brand">
                <div class="brand-logo">
                    <img src="../assets/images/logo-bombus.svg" alt="Bombus Logo" class="logo">
                    <span class="brand-text">Bombus</span>
                </div>
                <button class="aside-toggle-btn" id="aside_toggle">
                    <i class="ri-arrow-left-s-line"></i>
                </button>
            </div>

            <!-- Menu -->
            <nav class="aside-menu">
                <div class="menu-wrapper">
                    <!-- Dashboard -->
                    <div class="menu-item">
                        <a href="../index.html" class="menu-link">
                            <span class="menu-icon">
                                <i class="ri-dashboard-line"></i>
                            </span>
                            <span class="menu-text">企業管理儀表板</span>
                            <span class="menu-badge">L0.0</span>
                        </a>
                    </div>

                    <!-- L1 員工管理 -->
                    <div class="menu-section">
                        <div class="menu-section-title">
                            <span class="section-text">員工管理模組</span>
                        </div>
                    </div>

                    <div class="menu-item menu-accordion">
                        <div class="menu-link" data-toggle="collapse">
                            <span class="menu-icon module-l1">
                                <i class="ri-team-line"></i>
                            </span>
                            <span class="menu-text">員工管理</span>
                            <span class="menu-arrow">
                                <i class="ri-arrow-down-s-line"></i>
                            </span>
                        </div>
                        <div class="menu-sub">
                            <div class="menu-item">
                                <a href="../employee/recruitment.html" class="menu-link">
                                    <span class="menu-bullet"></span>
                                    <span class="menu-text">AI智能面試</span>
                                </a>
                            </div>
                            <div class="menu-item">
                                <a href="../employee/profile.html" class="menu-link">
                                    <span class="menu-bullet"></span>
                                    <span class="menu-text">員工檔案管理</span>
                                </a>
                            </div>
                            <div class="menu-item">
                                <a href="../employee/talent-pool.html" class="menu-link">
                                    <span class="menu-bullet"></span>
                                    <span class="menu-text">人才庫管理</span>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- L2 職能管理 -->
                    <div class="menu-item menu-accordion">
                        <div class="menu-link" data-toggle="collapse">
                            <span class="menu-icon module-l2">
                                <i class="ri-medal-line"></i>
                            </span>
                            <span class="menu-text">職能管理</span>
                            <span class="menu-arrow">
                                <i class="ri-arrow-down-s-line"></i>
                            </span>
                        </div>
                        <div class="menu-sub">
                            <div class="menu-item">
                                <a href="../competency/framework.html" class="menu-link">
                                    <span class="menu-bullet"></span>
                                    <span class="menu-text">職能框架開發</span>
                                </a>
                            </div>
                            <div class="menu-item">
                                <a href="../competency/assessment.html" class="menu-link">
                                    <span class="menu-bullet"></span>
                                    <span class="menu-text">職能評估系統</span>
                                </a>
                            </div>
                            <div class="menu-item">
                                <a href="../competency/gap-analysis.html" class="menu-link">
                                    <span class="menu-bullet"></span>
                                    <span class="menu-text">職能落差分析</span>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- L3 教育訓練 -->
                    <div class="menu-item menu-accordion show">
                        <div class="menu-link" data-toggle="collapse">
                            <span class="menu-icon module-l3">
                                <i class="ri-book-open-line"></i>
                            </span>
                            <span class="menu-text">教育訓練</span>
                            <span class="menu-arrow">
                                <i class="ri-arrow-down-s-line"></i>
                            </span>
                        </div>
                        <div class="menu-sub">
                            <div class="menu-item">
                                <a href="./talent-map.html" class="menu-link active">
                                    <span class="menu-bullet"></span>
                                    <span class="menu-text">人才地圖總覽</span>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- L4 專案管理 -->
                    <div class="menu-item menu-accordion">
                        <div class="menu-link" data-toggle="collapse">
                            <span class="menu-icon module-l4">
                                <i class="ri-folder-chart-line"></i>
                            </span>
                            <span class="menu-text">專案管理</span>
                            <span class="menu-arrow">
                                <i class="ri-arrow-down-s-line"></i>
                            </span>
                        </div>
                        <div class="menu-sub">
                            <div class="menu-item">
                                <a href="../project/list.html" class="menu-link">
                                    <span class="menu-bullet"></span>
                                    <span class="menu-text">專案列表</span>
                                </a>
                            </div>
                            <div class="menu-item">
                                <a href="../project/profit-prediction.html" class="menu-link">
                                    <span class="menu-bullet"></span>
                                    <span class="menu-text">AI損益預測</span>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- L5 績效管理 -->
                    <div class="menu-item menu-accordion">
                        <div class="menu-link" data-toggle="collapse">
                            <span class="menu-icon module-l5">
                                <i class="ri-line-chart-line"></i>
                            </span>
                            <span class="menu-text">績效管理</span>
                            <span class="menu-arrow">
                                <i class="ri-arrow-down-s-line"></i>
                            </span>
                        </div>
                        <div class="menu-sub">
                            <div class="menu-item">
                                <a href="../performance/review.html" class="menu-link">
                                    <span class="menu-bullet"></span>
                                    <span class="menu-text">績效考核</span>
                                </a>
                            </div>
                            <div class="menu-item">
                                <a href="../performance/360-feedback.html" class="menu-link">
                                    <span class="menu-bullet"></span>
                                    <span class="menu-text">360度回饋</span>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- L6 文化管理 -->
                    <div class="menu-item menu-accordion">
                        <div class="menu-link" data-toggle="collapse">
                            <span class="menu-icon module-l6">
                                <i class="ri-heart-line"></i>
                            </span>
                            <span class="menu-text">文化管理</span>
                            <span class="menu-arrow">
                                <i class="ri-arrow-down-s-line"></i>
                            </span>
                        </div>
                        <div class="menu-sub">
                            <div class="menu-item">
                                <a href="../culture/handbook.html" class="menu-link">
                                    <span class="menu-bullet"></span>
                                    <span class="menu-text">企業文化手冊</span>
                                </a>
                            </div>
                            <div class="menu-item">
                                <a href="../culture/eap.html" class="menu-link">
                                    <span class="menu-bullet"></span>
                                    <span class="menu-text">EAP員工協助</span>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- System Settings -->
                    <div class="menu-section">
                        <div class="menu-section-title">
                            <span class="section-text">系統設定</span>
                        </div>
                    </div>

                    <div class="menu-item">
                        <a href="../settings/permissions.html" class="menu-link">
                            <span class="menu-icon">
                                <i class="ri-shield-user-line"></i>
                            </span>
                            <span class="menu-text">權限管理</span>
                        </a>
                    </div>

                    <div class="menu-item">
                        <a href="../settings/backup.html" class="menu-link">
                            <span class="menu-icon">
                                <i class="ri-database-2-line"></i>
                            </span>
                            <span class="menu-text">備份管理</span>
                        </a>
                    </div>
                </div>
            </nav>

            <!-- Footer -->
            <div class="aside-footer">
                <div class="user-info">
                    <div class="user-avatar">
                        <img src="../assets/images/avatar.jpg" alt="User" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2240%22 height=%2240%22%3E%3Ccircle cx=%2220%22 cy=%2220%22 r=%2220%22 fill=%22%2364748B%22/%3E%3Ctext x=%2220%22 y=%2225%22 text-anchor=%22middle%22 fill=%22white%22 font-size=%2216%22 font-weight=%22bold%22%3EA%3C/text%3E%3C/svg%3E'">
                    </div>
                    <div class="user-details">
                        <div class="user-name">Admin</div>
                        <div class="user-role">系統管理員</div>
                    </div>
                </div>
            </div>
        </aside>
        <!-- End: Sidebar -->

        <!-- Begin: Page Wrapper -->
        <div class="page-wrapper">
            <!-- Begin: Header -->
            <header class="system-header" id="kt_header">
                <div class="header-container">
                    <!-- Mobile Toggle -->
                    <button class="mobile-toggle" id="mobile_toggle">
                        <i class="ri-menu-line"></i>
                    </button>

                    <!-- Page Title -->
                    <div class="page-title">
                        <h1 class="title-text">多層次人才地圖生成引擎</h1>
                        <div class="breadcrumb">
                            <span class="breadcrumb-item">教育訓練</span>
                            <i class="ri-arrow-right-s-line"></i>
                            <span class="breadcrumb-item active">人才地圖</span>
                        </div>
                    </div>

                    <!-- Header Actions -->
                    <div class="header-actions">
                        <button class="action-btn" id="search_btn">
                            <i class="ri-search-line"></i>
                        </button>
                        <div class="action-dropdown">
                            <button class="action-btn" id="notification_btn">
                                <i class="ri-notification-3-line"></i>
                                <span class="badge">5</span>
                            </button>
                        </div>
                        <div class="action-dropdown">
                            <button class="action-btn user-menu-btn" id="user_menu_btn">
                                <img src="../assets/images/avatar.jpg" alt="User" class="user-avatar-small" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2232%22 height=%2232%22%3E%3Ccircle cx=%2216%22 cy=%2216%22 r=%2216%22 fill=%22%2364748B%22/%3E%3Ctext x=%2216%22 y=%2221%22 text-anchor=%22middle%22 fill=%22white%22 font-size=%2214%22 font-weight=%22bold%22%3EA%3C/text%3E%3C/svg%3E'">
                            </button>
                        </div>
                    </div>
                </div>
            </header>
            <!-- End: Header -->

            <!-- Begin: Main Content -->
            <main class="main-content" id="kt_content">
                <div class="content-container">
                    <!-- Tabs Navigation -->
                    <div class="talent-map-tabs">
                        <button class="tab-btn active" data-tab="heatmap">
                            <i class="ri-fire-line"></i>
                            <span>組織職能熱力圖</span>
                        </button>
                        <button class="tab-btn" data-tab="nine-box">
                            <i class="ri-grid-line"></i>
                            <span>人才九宮格</span>
                        </button>
                        <button class="tab-btn" data-tab="learning-path">
                            <i class="ri-route-line"></i>
                            <span>學習發展路徑圖</span>
                        </button>
                        <button class="tab-btn" data-tab="key-talent">
                            <i class="ri-star-line"></i>
                            <span>關鍵人才儀表板</span>
                        </button>
                    </div>

                    <!-- Tab Content: Heatmap -->
                    <div class="tab-content active" id="heatmap-content">
                        <div class="map-card">
                            <div class="map-card-header">
                                <h2 class="map-card-title">
                                    <i class="ri-fire-fill"></i>
                                    組織職能熱力圖 (Competency Heatmap)
                                </h2>
                                <p class="map-card-desc">快速定位組織職能短板，優先安排培訓資源。使用紅綠燈號視覺化呈現各部門/員工的職能強弱。</p>
                            </div>
                            <div class="filters">
                                <label for="viewLevel">視圖層級:</label>
                                <select id="viewLevel">
                                    <option value="org">組織層級</option>
                                    <option value="dept">部門層級</option>
                                    <option value="emp">員工層級</option>
                                </select>
                                <label for="deptFilter">選擇部門:</label>
                                <select id="deptFilter">
                                    <option value="all">所有部門</option>
                                    <option value="RD">研發部</option>
                                    <option value="HR">人資部</option>
                                    <option value="Sales">業務部</option>
                                    <option value="Marketing">行銷部</option>
                                </select>
                                <label for="competencyType">職能類型:</label>
                                <select id="competencyType">
                                    <option value="all">所有職能</option>
                                    <option value="technical">技術職能</option>
                                    <option value="management">管理職能</option>
                                    <option value="soft">軟技能</option>
                                </select>
                            </div>
                            
                            <!-- 統計資訊 -->
                            <div class="filters" style="justify-content: space-around; background: linear-gradient(135deg, rgba(127, 156, 160, 0.05) 0%, rgba(127, 156, 160, 0.1) 100%);">
                                <div style="text-align: center;">
                                    <div style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 5px;">平均分數</div>
                                    <div id="avgScore" style="font-size: 24px; font-weight: 700; color: var(--color-l3-petrol);">--</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 5px;">優秀職能數</div>
                                    <div id="excellentCount" style="font-size: 24px; font-weight: 700; color: var(--color-success);">--</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 5px;">需培訓人數</div>
                                    <div id="needTrainingCount" style="font-size: 24px; font-weight: 700; color: var(--color-danger);">--</div>
                                </div>
                            </div>
                            <div id="heatmapChart" class="chart-container"></div>
                            <button class="export-button" data-chart-id="heatmapChart">
                                <i class="ri-download-2-line"></i>
                                匯出 PNG
                            </button>
                        </div>
                    </div>

                    <!-- Tab Content: Nine Box -->
                    <div class="tab-content" id="nine-box-content">
                        <div class="map-card">
                            <div class="map-card-header">
                                <h2 class="map-card-title">
                                    <i class="ri-grid-fill"></i>
                                    人才九宮格 (Talent 9-Box Grid)
                                </h2>
                                <p class="map-card-desc">年度人才盤點、晉升決策、接班人規劃的利器。支援拖曳員工頭像進行情境模擬。</p>
                            </div>
                            
                            <!-- 篩選器 -->
                            <div class="filters">
                                <label for="nineBoxDeptFilter">部門篩選:</label>
                                <select id="nineBoxDeptFilter" onchange="if(typeof updateNineBox === 'function') updateNineBox();">
                                    <option value="all">所有部門</option>
                                    <option value="rd">研發部</option>
                                    <option value="hr">人資部</option>
                                    <option value="sales">業務部</option>
                                    <option value="marketing">行銷部</option>
                                </select>
                                <label for="nineBoxLevelFilter">職級篩選:</label>
                                <select id="nineBoxLevelFilter" onchange="if(typeof updateNineBox === 'function') updateNineBox();">
                                    <option value="all">所有職級</option>
                                    <option value="staff">一般員工</option>
                                    <option value="middle">中階主管</option>
                                    <option value="senior">高階主管</option>
                                </select>
                                <button class="button" onclick="if(typeof toggleSimulationMode === 'function') toggleSimulationMode();" style="margin-left: auto;">
                                    <i class="ri-drag-drop-line"></i>
                                    情境模擬模式
                                </button>
                            </div>
                            
                            <!-- 九宮格容器 - 加入軸標籤 -->
                            <div style="position: relative; margin: 30px 0 50px 75px;">
                                <!-- Y軸標籤 (發展潛力) -->
                                <div style="position: absolute; left: -95px; top: 50%; transform: translateY(-50%) rotate(-90deg); font-weight: 700; color: var(--color-text-primary); font-size: 14px; white-space: nowrap;">
                                    發展潛力 (Potential) →
                                </div>
                                
                                <!-- X軸標籤 (績效表現) -->
                                <div style="text-align: center; font-weight: 700; color: var(--color-text-primary); font-size: 14px; margin-bottom: 15px;">
                                    績效表現 (Performance) →
                                </div>
                                
                                <div class="nine-box-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                                    <!-- 第一行: 高潛力 (從左到右：低績效→中績效→高績效) -->
                                    <div class="box-cell" data-category="develop" style="background: linear-gradient(135deg, rgba(227, 192, 136, 0.15) 0%, rgba(227, 192, 136, 0.25) 100%); border: 2px solid #E3C088; border-radius: 12px; padding: 20px; min-height: 200px;">
                                        <div style="font-weight: 700; color: var(--color-text-primary); margin-bottom: 5px;">待開發</div>
                                        <div style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 15px;">低績效高潛力</div>
                                        <div style="font-size: 24px; font-weight: 700; color: #E3C088; margin-bottom: 15px;"><span id="count-develop">0</span> 人</div>
                                        <div class="employee-list" id="list-develop"></div>
                                    </div>
                                    <div class="box-cell" data-category="potential" style="background: linear-gradient(135deg, rgba(127, 176, 149, 0.15) 0%, rgba(127, 176, 149, 0.25) 100%); border: 2px solid #7FB095; border-radius: 12px; padding: 20px; min-height: 200px;">
                                        <div style="font-weight: 700; color: var(--color-text-primary); margin-bottom: 5px;">潛力股</div>
                                        <div style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 15px;">中績效高潛力</div>
                                        <div style="font-size: 24px; font-weight: 700; color: #7FB095; margin-bottom: 15px;"><span id="count-potential">0</span> 人</div>
                                        <div class="employee-list" id="list-potential"></div>
                                    </div>
                                    <div class="box-cell" data-category="star" style="background: linear-gradient(135deg, rgba(141, 163, 153, 0.15) 0%, rgba(141, 163, 153, 0.3) 100%); border: 2px solid #8DA399; border-radius: 12px; padding: 20px; min-height: 200px;">
                                        <div style="font-weight: 700; color: var(--color-text-primary); margin-bottom: 5px;">⭐ 明星員工</div>
                                        <div style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 15px;">高績效高潛力</div>
                                        <div style="font-size: 24px; font-weight: 700; color: #8DA399; margin-bottom: 15px;"><span id="count-star">0</span> 人</div>
                                        <div class="employee-list" id="list-star"></div>
                                    </div>
                                    
                                    <!-- 第二行: 中潛力 (從左到右：低績效→中績效→高績效) -->
                                    <div class="box-cell" data-category="risk" style="background: linear-gradient(135deg, rgba(199, 127, 127, 0.15) 0%, rgba(199, 127, 127, 0.25) 100%); border: 2px solid #C77F7F; border-radius: 12px; padding: 20px; min-height: 200px;">
                                        <div style="font-weight: 700; color: var(--color-text-primary); margin-bottom: 5px;">風險員工</div>
                                        <div style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 15px;">低績效中潛力</div>
                                        <div style="font-size: 24px; font-weight: 700; color: #C77F7F; margin-bottom: 15px;"><span id="count-risk">0</span> 人</div>
                                        <div class="employee-list" id="list-risk"></div>
                                    </div>
                                    <div class="box-cell" data-category="stable" style="background: linear-gradient(135deg, rgba(141, 168, 190, 0.15) 0%, rgba(141, 168, 190, 0.25) 100%); border: 2px solid #8DA8BE; border-radius: 12px; padding: 20px; min-height: 200px;">
                                        <div style="font-weight: 700; color: var(--color-text-primary); margin-bottom: 5px;">穩定員工</div>
                                        <div style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 15px;">中績效中潛力</div>
                                        <div style="font-size: 24px; font-weight: 700; color: #8DA8BE; margin-bottom: 15px;"><span id="count-stable">0</span> 人</div>
                                        <div class="employee-list" id="list-stable"></div>
                                    </div>
                                    <div class="box-cell" data-category="specialist" style="background: linear-gradient(135deg, rgba(127, 156, 160, 0.15) 0%, rgba(127, 156, 160, 0.25) 100%); border: 2px solid #7F9CA0; border-radius: 12px; padding: 20px; min-height: 200px;">
                                        <div style="font-weight: 700; color: var(--color-text-primary); margin-bottom: 5px;">核心骨幹</div>
                                        <div style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 15px;">高績效中潛力</div>
                                        <div style="font-size: 24px; font-weight: 700; color: #7F9CA0; margin-bottom: 15px;"><span id="count-specialist">0</span> 人</div>
                                        <div class="employee-list" id="list-specialist"></div>
                                    </div>
                                    
                                    <!-- 第三行: 低潛力 (從左到右：低績效→中績效→高績效) -->
                                    <div class="box-cell" data-category="exit" style="background: linear-gradient(135deg, rgba(133, 142, 150, 0.15) 0%, rgba(133, 142, 150, 0.25) 100%); border: 2px solid #858E96; border-radius: 12px; padding: 20px; min-height: 200px;">
                                        <div style="font-weight: 700; color: var(--color-text-primary); margin-bottom: 5px;">淘汰名單</div>
                                        <div style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 15px;">低績效低潛力</div>
                                        <div style="font-size: 24px; font-weight: 700; color: #858E96; margin-bottom: 15px;"><span id="count-exit">0</span> 人</div>
                                        <div class="employee-list" id="list-exit"></div>
                                    </div>
                                    <div class="box-cell" data-category="need-improve" style="background: linear-gradient(135deg, rgba(184, 125, 123, 0.15) 0%, rgba(184, 125, 123, 0.25) 100%); border: 2px solid #B87D7B; border-radius: 12px; padding: 20px; min-height: 200px;">
                                        <div style="font-weight: 700; color: var(--color-text-primary); margin-bottom: 5px;">需改善</div>
                                        <div style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 15px;">中績效低潛力</div>
                                        <div style="font-size: 24px; font-weight: 700; color: #B87D7B; margin-bottom: 15px;"><span id="count-need-improve">0</span> 人</div>
                                        <div class="employee-list" id="list-need-improve"></div>
                                    </div>
                                    <div class="box-cell" data-category="expert" style="background: linear-gradient(135deg, rgba(214, 162, 140, 0.15) 0%, rgba(214, 162, 140, 0.25) 100%); border: 2px solid #D6A28C; border-radius: 12px; padding: 20px; min-height: 200px;">
                                        <div style="font-weight: 700; color: var(--color-text-primary); margin-bottom: 5px;">專業專家</div>
                                        <div style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 15px;">高績效低潛力</div>
                                        <div style="font-size: 24px; font-weight: 700; color: #D6A28C; margin-bottom: 15px;"><span id="count-expert">0</span> 人</div>
                                        <div class="employee-list" id="list-expert"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 人才分佈統計圖表 -->
                            <div style="margin-top: 30px;">
                                <h3 style="color: var(--color-text-primary); margin-bottom: 20px; font-size: 18px;">人才分佈統計</h3>
                                <div class="chart-combo">
                                    <div id="distributionChart" class="chart-container" style="height: 400px;"></div>
                                    <div id="scatterChart" class="chart-container" style="height: 400px;"></div>
                                </div>
                            </div>
                            
                            <div style="margin-top: 20px; display: flex; gap: 10px;">
                                <button class="export-button" data-chart-id="distributionChart">
                                    <i class="ri-download-2-line"></i>
                                    匯出圓餅圖 PNG
                                </button>
                                <button class="export-button" data-chart-id="scatterChart">
                                    <i class="ri-download-2-line"></i>
                                    匯出散佈圖 PNG
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Tab Content: Learning Path -->
                    <div class="tab-content" id="learning-path-content">
                        <div class="map-card">
                            <div class="map-card-header">
                                <h2 class="map-card-title">
                                    <i class="ri-route-fill"></i>
                                    學習發展路徑圖 (Learning Journey Map)
                                </h2>
                                <p class="map-card-desc">為員工提供清晰的職涯發展路徑與個人化學習地圖。AI智能推薦學習順序與時間。</p>
                            </div>

                            <!-- Filter for Level -->
                            <div class="filters" style="margin-bottom: 30px;">
                                <label for="learningPathLevel">視圖層級:</label>
                                <select id="learningPathLevel" onchange="if(typeof switchLevel === 'function') switchLevel(this.value)">
                                    <option value="org">組織層級</option>
                                    <option value="dept">部門層級</option>
                                    <option value="individual">個人層級</option>
                                </select>
                            </div>

                            <!-- Progress Overview (from Demo) -->
                            <div class="progress-overview" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px;">
                                <div class="progress-card" style="background: white; border-radius: 12px; padding: 20px; border: 1px solid var(--color-border); position: relative; overflow: hidden; border-top: 4px solid var(--color-l1-sage);">
                                    <div style="font-size: 13px; color: var(--color-text-secondary); margin-bottom: 10px;">整體培訓完成率</div>
                                    <div style="font-size: 32px; font-weight: 700; color: var(--color-text-primary); margin-bottom: 10px;">72%</div>
                                    <div style="width: 100%; height: 8px; background: var(--color-bg-base); border-radius: 4px; overflow: hidden;">
                                        <div style="width: 72%; height: 100%; background: var(--color-l1-sage);"></div>
                                    </div>
                                </div>
                                <div class="progress-card" style="background: white; border-radius: 12px; padding: 20px; border: 1px solid var(--color-border); position: relative; overflow: hidden; border-top: 4px solid var(--color-l2-clay);">
                                    <div style="font-size: 13px; color: var(--color-text-secondary); margin-bottom: 10px;">核心職能覆蓋率</div>
                                    <div style="font-size: 32px; font-weight: 700; color: var(--color-text-primary); margin-bottom: 10px;">85%</div>
                                    <div style="width: 100%; height: 8px; background: var(--color-bg-base); border-radius: 4px; overflow: hidden;">
                                        <div style="width: 85%; height: 100%; background: var(--color-l2-clay);"></div>
                                    </div>
                                </div>
                                <div class="progress-card" style="background: white; border-radius: 12px; padding: 20px; border: 1px solid var(--color-border); position: relative; overflow: hidden; border-top: 4px solid var(--color-l3-petrol);">
                                    <div style="font-size: 13px; color: var(--color-text-secondary); margin-bottom: 10px;">課程參與度</div>
                                    <div style="font-size: 32px; font-weight: 700; color: var(--color-text-primary); margin-bottom: 10px;">68%</div>
                                    <div style="width: 100%; height: 8px; background: var(--color-bg-base); border-radius: 4px; overflow: hidden;">
                                        <div style="width: 68%; height: 100%; background: var(--color-l3-petrol);"></div>
                                    </div>
                                </div>
                                <div class="progress-card" style="background: white; border-radius: 12px; padding: 20px; border: 1px solid var(--color-border); position: relative; overflow: hidden; border-top: 4px solid var(--color-l4-mauve);">
                                    <div style="font-size: 13px; color: var(--color-text-secondary); margin-bottom: 10px;">認證通過率</div>
                                    <div style="font-size: 32px; font-weight: 700; color: var(--color-text-primary); margin-bottom: 10px;">91%</div>
                                    <div style="width: 100%; height: 8px; background: var(--color-bg-base); border-radius: 4px; overflow: hidden;">
                                        <div style="width: 91%; height: 100%; background: var(--color-l4-mauve);"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Employee Selector -->
                            <div id="employeeSelector" style="display:none; margin-bottom: 20px; padding: 20px; background: var(--color-bg-base); border-radius: 10px;">
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <label for="employeeSelect" style="font-size: 14px; font-weight: 600; color: var(--color-text-primary); white-space: nowrap;">選擇員工:</label>
                                    <select id="employeeSelect" onchange="if(typeof updateIndividualPath === 'function') updateIndividualPath()" style="padding: 10px 15px; border: 1px solid var(--color-border); border-radius: 8px; background: white; color: var(--color-text-primary); font-size: 14px; cursor: pointer; min-width: 250px; transition: var(--transition);">
                                        <option value="">請選擇員工...</option>
                                        <option value="e001">王小明 (前端工程師)</option>
                                        <option value="e002">李小華 (業務專員)</option>
                                        <option value="e003">張大同 (行銷專員)</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Path Summary -->
                            <div id="pathSummary" style="display: none; background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); border: 2px solid #667eea30; border-radius: 12px; padding: 20px; margin: 20px 0;">
                                <h3 style="color: var(--color-brand-main); margin-bottom: 12px; font-size: 16px;">🎯 <span id="pathTitle">個人學習路徑</span></h3>
                                <div id="pathDescription" style="margin-bottom: 15px; font-size: 14px; color: var(--color-text-secondary);"></div>
                                <div id="pathSteps" style="display: flex; gap: 10px; overflow-x: auto;"></div>
                            </div>

                            <div id="timelineChart" class="chart-container"></div>
                            <div id="skillTreeChart" class="chart-container" style="margin-top: 30px;"></div>
                            
                            <div id="recommendationPanel" class="recommendation-panel" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 30px;"></div>

                            <div style="margin-top: 20px; display: flex; gap: 10px;">
                                <button class="export-button" data-chart-id="timelineChart">
                                    <i class="ri-download-2-line"></i>
                                    匯出時間軸 PNG
                                </button>
                                <button class="export-button" data-chart-id="skillTreeChart" style="margin-left: 10px;">
                                    <i class="ri-download-2-line"></i>
                                    匯出技能樹 PNG
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Tab Content: Key Talent -->
                    <div class="tab-content" id="key-talent-content">
                        <div class="map-card">
                            <div class="map-card-header">
                                <h2 class="map-card-title">
                                    <i class="ri-star-fill"></i>
                                    關鍵人才儀表板 (Key Talent Dashboard)
                                </h2>
                                <p class="map-card-desc">高階主管決策、人才保留策略、薪酬調整參考。即時監控關鍵人才風險與預警。</p>
                            </div>
                            
                            <div class="filters">
                                <label for="talentDeptFilter">選擇部門:</label>
                                <select id="talentDeptFilter">
                                    <option value="all">所有部門</option>
                                    <option value="RD">研發部</option>
                                    <option value="HR">人資部</option>
                                    <option value="Sales">業務部</option>
                                    <option value="Marketing">行銷部</option>
                                </select>
                            </div>

                            <div class="dashboard-grid">
                                <div class="metric-card">
                                    <h3>關鍵職位覆蓋率</h3>
                                    <p class="metric-value" style="color: var(--color-success);">85%</p>
                                    <p class="metric-description">財務經理有 2 位接班人候選</p>
                                </div>
                                <div class="metric-card">
                                    <h3>高風險人才預警</h3>
                                    <p class="metric-value" style="color: var(--color-danger);">3 人</p>
                                    <p class="metric-description">離職傾向 > 60%</p>
                                    <button class="small-button">啟動留才計畫</button>
                                </div>
                                <div class="metric-card">
                                    <h3>人才流失成本估算</h3>
                                    <p class="metric-value" style="color: var(--color-warning);">NT$ 1,500,000</p>
                                    <p class="metric-description">替換成本 + 培訓成本 + 產出損失</p>
                                </div>
                                <div class="metric-card">
                                    <h3>外部挖角風險評估</h3>
                                    <p class="metric-value" style="color: var(--color-info);">中等</p>
                                    <p class="metric-description">市場薪資對比、產業搶人熱度</p>
                                </div>
                            </div>

                            <!-- High Risk Alert Panel -->
                            <div class="alert-panel" style="background: linear-gradient(135deg, rgba(199, 127, 127, 0.08) 0%, rgba(199, 127, 127, 0.02) 100%); border: 1px solid rgba(199, 127, 127, 0.2); border-radius: 12px; padding: 25px; margin-bottom: 30px;">
                                <div class="alert-header" style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                                    <div class="icon" style="width: 40px; height: 40px; background: #C77F7F; color: white; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                                        <i class="ri-alert-fill"></i>
                                    </div>
                                    <h3 style="font-size: 18px; color: #C77F7F; margin: 0;">高風險人才預警（離職傾向 > 60%）</h3>
                                </div>
                                <div class="alert-list" id="alertList" style="display: flex; flex-direction: column; gap: 12px;"></div>
                            </div>

                            <!-- Succession Planning -->
                            <div style="margin-bottom: 30px;">
                                <h2 style="font-size: 18px; font-weight: 600; color: var(--color-text-primary); margin-bottom: 20px;">關鍵職位接班人規劃</h2>
                                <div class="succession-panel" id="successionPanel" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;"></div>
                            </div>

                            <!-- Charts -->
                            <div class="chart-combo" style="margin-bottom: 20px;">
                                <div style="background: white; border-radius: 12px; padding: 20px; border: 1px solid var(--color-border);">
                                    <div id="coverageChart" class="chart-container" style="height: 400px;"></div>
                                    <button class="export-button" data-chart-id="coverageChart">
                                        <i class="ri-download-2-line"></i>
                                        匯出覆蓋率圖表 PNG
                                    </button>
                                </div>
                                <div style="background: white; border-radius: 12px; padding: 20px; border: 1px solid var(--color-border);">
                                    <div id="costChart" class="chart-container" style="height: 400px;"></div>
                                    <button class="export-button" data-chart-id="costChart">
                                        <i class="ri-download-2-line"></i>
                                        匯出成本分析 PNG
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
            <!-- End: Main Content -->

            <!-- Begin: Footer -->
            <footer class="system-footer">
                <div class="footer-content">
                    <div class="footer-left">
                        <span>© 2025 Bombus 企業管理系統</span>
                    </div>
                    <div class="footer-right">
                        <a href="#">關於</a>
                        <a href="#">支援</a>
                        <a href="#">文件</a>
                    </div>
                </div>
            </footer>
            <!-- End: Footer -->
        </div>
        <!-- End: Page Wrapper -->
    </div>

    <!-- Detail Modal for Heatmap -->
    <div id="detailModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 12px; padding: 30px; max-width: 600px; width: 90%; position: relative;">
            <button onclick="$('#detailModal').fadeOut(300)" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 24px; cursor: pointer; color: var(--color-text-secondary);">&times;</button>
            <h3 id="modalTitle" style="color: var(--color-text-primary); margin-bottom: 5px;">-</h3>
            <p id="modalSubtitle" style="color: var(--color-text-secondary); font-size: 14px; margin-bottom: 20px;">-</p>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 25px; padding: 20px; background: var(--color-bg-base); border-radius: 10px;">
                <div>
                    <div style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 5px;">當前分數</div>
                    <div id="modalCurrentScore" style="font-size: 28px; font-weight: 700;">-</div>
                </div>
                <div>
                    <div style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 5px;">要求分數</div>
                    <div id="modalRequiredScore" style="font-size: 28px; font-weight: 700; color: var(--color-text-secondary);">-</div>
                </div>
                <div>
                    <div style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 5px;">落差</div>
                    <div id="modalGap" style="font-size: 28px; font-weight: 700;">-</div>
                </div>
                <div>
                    <div style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 5px;">部門排名</div>
                    <div id="modalRank" style="font-size: 28px; font-weight: 700; color: var(--color-text-primary);">-</div>
                </div>
            </div>
            
            <h4 style="color: var(--color-text-primary); margin-bottom: 15px; font-size: 16px;">💡 AI 推薦課程</h4>
            <div id="recommendedCourses" style="display: flex; flex-direction: column; gap: 10px;">
                <!-- Courses will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Talent Map JS - 必須先載入 -->
    <script src="../assets/js/heatmap.js"></script>
    <script src="../assets/js/nine-box.js"></script>
    <script src="../assets/js/learning-path.js"></script>
    <script src="../assets/js/key-talent.js"></script>
    
    <!-- System JS -->
    <script src="../assets/js/system.js"></script>
    
    <script>
        // Tab Switching
        $(document).ready(function() {
            // 延遲初始化，確保 DOM 完全載入
            setTimeout(function() {
                // 初始化第一個 tab 的圖表
                if (typeof initHeatmap === 'function') {
                    initHeatmap();
                    window.heatmapInitialized = true;
                }
                
                // 觸發第一次更新以生成數據
                if (typeof updateHeatmap === 'function') {
                    updateHeatmap();
                }
            }, 100);
            
            $('.tab-btn').on('click', function() {
                const tabName = $(this).data('tab');
                
                // 更新 tab 按鈕狀態
                $('.tab-btn').removeClass('active');
                $(this).addClass('active');
                
                // 更新 tab 內容顯示
                $('.tab-content').removeClass('active');
                $(`#${tabName}-content`).addClass('active');
                
                // 延遲初始化對應的圖表，確保 DOM 已切換
                setTimeout(function() {
                    // 初始化對應的圖表
                    if (tabName === 'heatmap') {
                        if (!window.heatmapInitialized && typeof initHeatmap === 'function') {
                            initHeatmap();
                            window.heatmapInitialized = true;
                        }
                    } else if (tabName === 'nine-box') {
                        if (!window.nineBoxInitialized) {
                            // 延遲初始化，確保容器已渲染
                            setTimeout(function() {
                                // 呼叫統一的初始化函數
                                if (typeof initNineBoxCharts === 'function') {
                                    initNineBoxCharts();
                                }
                                
                                // 生成員工數據並更新
                                if (typeof generateEmployees === 'function') {
                                    // generateEmployees 會回傳數據，但也更新全域變數
                                    window.nineBoxEmployees = generateEmployees();
                                    
                                    if (typeof updateNineBox === 'function') {
                                        updateNineBox();
                                    }
                                }
                            }, 100);
                            
                            window.nineBoxInitialized = true;
                        } else {
                            // 如果已經初始化過，切換回來時要 resize 圖表
                             setTimeout(function() {
                                if (typeof initNineBoxCharts === 'function') {
                                    // 這裡再次呼叫 init 可以確保 resize 正確 (但會清空圖表)
                                    initNineBoxCharts();
                                }
                                // 必須重新填入數據，否則圖表會是空白的
                                if (typeof updateNineBox === 'function') {
                                    updateNineBox();
                                }
                            }, 100);
                        }
                    } else if (tabName === 'learning-path') {
                        if (!window.learningPathInitialized) {
                            setTimeout(function() {
                                if (typeof initLearningPathCharts === 'function') {
                                    initLearningPathCharts();
                                }
                            }, 100);
                            window.learningPathInitialized = true;
                        } else {
                            setTimeout(function() {
                                if (typeof initLearningPathCharts === 'function') {
                                    initLearningPathCharts();
                                }
                            }, 100);
                        }
                    } else if (tabName === 'key-talent') {
                        if (!window.keyTalentInitialized) {
                            setTimeout(function() {
                                if (typeof initKeyTalentCharts === 'function') {
                                    initKeyTalentCharts();
                                }
                            }, 100);
                            window.keyTalentInitialized = true;
                        } else {
                            setTimeout(function() {
                                if (typeof initKeyTalentCharts === 'function') {
                                    initKeyTalentCharts();
                                }
                            }, 100);
                        }
                    }
                }, 50);
            });
        });
    </script>
</body>
</html>
